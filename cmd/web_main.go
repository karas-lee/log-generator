package main

import (
	"flag"
	"fmt"
	"log-generator/internal/monitor"
	"os"
	"os/signal"
	"syscall"
)

// WebApp - ì›¹ ê¸°ë°˜ ë¡œê·¸ ìƒì„±ê¸° ì• í”Œë¦¬ì¼€ì´ì…˜
type WebApp struct {
	controlServer *monitor.ControlServer
	port          int
}

func main() {
	// ëª…ë ¹í–‰ íŒŒë¼ë¯¸í„° íŒŒì‹±
	var port int
	flag.IntVar(&port, "port", 8080, "ì›¹ ì„œë²„ í¬íŠ¸")
	flag.Parse()

	fmt.Println(`
 â–ˆâ–ˆâ•—     â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— 
 â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•”â•â•â•â•â• â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
 â–ˆâ–ˆâ•‘  â–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•    â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
 â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
 â•šâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•    â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
  â•šâ•â•â•â•šâ•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•      â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•   â•šâ•â•    â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•
`)
	fmt.Println("ğŸŒ ì›¹ ê¸°ë°˜ 400ë§Œ EPS ë¡œê·¸ ìƒì„±ê¸° ì œì–´ ì‹œìŠ¤í…œ")
	fmt.Println("ğŸ“Š ì™„ì „í•œ ì›¹ UIë¡œ ì„¤ì •/ì‹¤í–‰/ëª¨ë‹ˆí„°ë§ í†µí•© ê´€ë¦¬")
	fmt.Println()

	// ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„±
	app := &WebApp{
		controlServer: monitor.NewControlServer(port),
		port:          port,
	}

	// ì„œë²„ ì‹œì‘
	err := app.Start()
	if err != nil {
		fmt.Printf("âŒ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹¤íŒ¨: %v\n", err)
		os.Exit(1)
	}

	fmt.Printf("âœ… ì›¹ ì œì–´ ì‹œìŠ¤í…œì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!\n")
	fmt.Printf("ğŸŒ ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì†: http://localhost:%d\n", port)
	fmt.Printf("ğŸ“± ê°„í¸ ì œì–´ UI: http://localhost:%d/control\n", port)
	fmt.Printf("ğŸ”§ API ë¬¸ì„œ: http://localhost:%d/api/\n", port)
	fmt.Println()
	fmt.Println("ğŸ›ï¸  ì›¹ UI ê¸°ëŠ¥:")
	fmt.Println("   âœ“ ì‹¤ì‹œê°„ ì„¤ì • ë³€ê²½")
	fmt.Println("   âœ“ ì›í´ë¦­ ì‹œì‘/ì •ì§€/ì¬ì‹œì‘")
	fmt.Println("   âœ“ ì‹¤ì‹œê°„ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§")
	fmt.Println("   âœ“ ì›Œì»¤ ìƒíƒœ ì‹œê°í™”")
	fmt.Println("   âœ“ ì‹œìŠ¤í…œ ë¡œê·¸ ì‹¤ì‹œê°„ í‘œì‹œ")
	fmt.Println("   âœ“ ê³ ê¸‰ ì„¤ì • ë° ìµœì í™”")
	fmt.Println()

	// ì‹œê·¸ë„ í•¸ë“¤ë§
	sigChan := make(chan os.Signal, 1)
	signal.Notify(sigChan, os.Interrupt, syscall.SIGTERM)

	// ì¢…ë£Œ ì‹ í˜¸ ëŒ€ê¸°
	<-sigChan
	fmt.Println("\nğŸ›‘ ì¢…ë£Œ ì‹ í˜¸ ìˆ˜ì‹ , ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì¢…ë£Œ ì¤‘...")

	// ì• í”Œë¦¬ì¼€ì´ì…˜ ì •ì§€
	err = app.Stop()
	if err != nil {
		fmt.Printf("âš ï¸  ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì •ì§€ ì¤‘ ì˜¤ë¥˜: %v\n", err)
	}

	fmt.Println("âœ… ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì •ìƒ ì¢…ë£Œ")
}

// Start - ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘
func (wa *WebApp) Start() error {
	return wa.controlServer.Start()
}

// Stop - ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì •ì§€
func (wa *WebApp) Stop() error {
	return wa.controlServer.Stop()
}